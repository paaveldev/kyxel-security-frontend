import"./hoisted.C3h40C66.js";const w=void 0,E="/",C=document.getElementById("verify-form"),s=document.getElementById("email"),f=document.getElementById("code"),r=document.getElementById("verify-btn"),o=document.getElementById("resend-btn"),e=document.getElementById("verify-message"),i=document.getElementById("countdown"),v=sessionStorage.getItem("verifyEmail");s&&v&&(s.value=v,s.readOnly=!0,s.style.opacity="0.7",s.style.cursor="not-allowed");let m=null,d=600,y=!1;function x(n){const t=Math.floor(n/60),a=n%60;return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`}function I(){i&&(i.textContent=`Code expires in: ${x(d)}`),d<=0?(clearInterval(m),y=!0,i&&(i.textContent=""),e&&(e.textContent="Code expired. Please request a new one.",e.style.color="#f97373"),r&&(r.disabled=!0),f&&(f.disabled=!0)):d--}function p(){d=600,y=!1,f&&(f.disabled=!1),r&&(r.disabled=!1),i&&(i.textContent=`Code expires in: ${x(d)}`),clearInterval(m),m=setInterval(I,1e3)}o?.addEventListener("click",async()=>{const n=s?.value;if(!n){e&&(e.textContent="Please enter your email address first.",e.style.color="#f97373");return}o&&(o.disabled=!0,o.textContent="Sending...");try{const t=await fetch(`${w}/auth/resend-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n})});if(!t.ok){let a="Failed to resend code";try{const c=await t.json();c?.message&&(a=c.message)}catch{}throw new Error(a)}p(),e&&(e.textContent="New code sent to your email.",e.style.color="#4ade80")}catch(t){console.error(t),e&&(e.textContent=t?.message||"Failed to resend code. Please try again.",e.style.color="#f97373")}finally{o&&(o.disabled=!1,o.textContent="Resend code")}});C?.addEventListener("submit",async n=>{if(n.preventDefault(),y){e&&(e.textContent="Code expired. Please request a new one.",e.style.color="#f97373");return}if(!e||!r)return;r.disabled=!0,e.textContent="Verifying...",e.style.color="#cbd5f5";const t=new FormData(C),a=t.get("email"),c=t.get("code");try{const l=await fetch(`${w}/auth/verify-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,code:c})});if(!l.ok){let u="Verification failed";try{const g=await l.json();g?.message&&(u=g.message)}catch{}throw new Error(u)}e.textContent="Email verified successfully! Account created. Redirecting...",e.style.color="#4ade80",clearInterval(m),sessionStorage.removeItem("verifyEmail"),setTimeout(()=>{window.location.href=`${E}login`},1500)}catch(l){console.error(l),e.textContent=l?.message||"Invalid code. Please try again.",e.style.color="#f97373"}finally{r.disabled=!1}});p();
