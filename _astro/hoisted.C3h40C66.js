(function(){const n=new IntersectionObserver(o=>{o.forEach(d=>{d.isIntersecting&&d.target.classList.add("show")})},{threshold:.12});document.querySelectorAll(".reveal").forEach(o=>n.observe(o));const e=document.querySelector(".site-header");if(e){const o=()=>{window.scrollY>40?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",o,{passive:!0}),o()}})();const L=document.getElementById("mobile-menu-btn"),i=document.getElementById("mobile-menu"),h=document.getElementById("close-menu");function k(){i&&(i.classList.remove("hidden","opacity-0","pointer-events-none"),i.classList.add("flex","opacity-100","pointer-events-auto"),document.body.style.overflow="hidden")}function r(){i&&(i.classList.remove("opacity-100","pointer-events-auto"),i.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("flex"),document.body.style.overflow=""},300))}L&&L.addEventListener("click",k);h&&h.addEventListener("click",r);window.addEventListener("close-mobile-menu",r);i&&i.addEventListener("click",n=>{n.target===i&&r()});function I(){try{return!!localStorage.getItem("ks_token")}catch{return!1}}function w(){try{const n=localStorage.getItem("ks_full_name")||localStorage.getItem("ks_fullname")||localStorage.getItem("ks_name");if(!n)return"K";const e=n.trim().split(/\s+/);return e.length===1?e[0].charAt(0).toUpperCase():(e[0].charAt(0)+e[e.length-1].charAt(0)).toUpperCase()}catch{return"K"}}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("nav-auth-guest-desktop"),e=document.getElementById("nav-auth-user-desktop"),o=document.getElementById("nav-auth-guest-mobile"),d=document.getElementById("nav-auth-user-mobile"),y=I(),a=document.getElementById("user-menu-button"),s=document.getElementById("user-menu-dropdown");if(y){n&&n.classList.add("hidden"),e&&(e.classList.remove("hidden"),e.classList.add("flex")),o&&o.classList.add("hidden"),d&&d.classList.remove("hidden");const t=w();a&&t&&(a.textContent=t)}else n&&n.classList.remove("hidden"),e&&(e.classList.add("hidden"),e.classList.remove("flex")),o&&o.classList.remove("hidden"),d&&d.classList.add("hidden");const u=["opacity-100","translate-y-0","pointer-events-auto","scale-100"],m=["opacity-0","translate-y-2","pointer-events-none","scale-95"];let l=!1;const E=()=>{!s||l||(l=!0,s.classList.remove("hidden"),requestAnimationFrame(()=>{s.classList.remove(...m),s.classList.add(...u)}),a&&a.setAttribute("aria-expanded","true"))},c=()=>{if(!s||!l)return;l=!1,s.classList.remove(...u),s.classList.add(...m);const t=g=>{g.propertyName==="opacity"&&!l&&s.classList.add("hidden")};s.addEventListener("transitionend",t,{once:!0}),a&&a.setAttribute("aria-expanded","false")};s&&s.addEventListener("click",t=>t.stopPropagation()),a&&s&&(a.addEventListener("click",t=>{t.stopPropagation(),l?c():E()}),document.addEventListener("click",c),document.addEventListener("keydown",t=>{t.key==="Escape"&&c()}));const f=document.getElementById("logout-desktop"),v=document.getElementById("logout-mobile");function p(t){t&&t.preventDefault();try{localStorage.removeItem("ks_token"),localStorage.removeItem("ks_full_name"),localStorage.removeItem("ks_fullname"),localStorage.removeItem("ks_name")}catch{}window.location.reload()}f&&f.addEventListener("click",p),v&&v.addEventListener("click",t=>{p(t),window.dispatchEvent(new Event("close-mobile-menu"))})});
