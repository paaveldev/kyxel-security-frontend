import"./hoisted.C3h40C66.js";const C=void 0,b="/kyxel-security-frontend/",E=document.getElementById("register-form"),s=document.getElementById("register-message"),h=document.getElementById("password"),y=document.getElementById("confirmPassword"),g=document.getElementById("password-strength-bar"),p=document.getElementById("password-strength-text"),c=document.getElementById("password-match-text");function I(n){if(!n)return{strength:0,text:"",color:"#f97373"};let t=0,e={length:n.length>=8,uppercase:/[A-Z]/.test(n),lowercase:/[a-z]/.test(n),number:/[0-9]/.test(n),special:/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(n)};e.length&&(t+=20),e.uppercase&&(t+=20),e.lowercase&&(t+=20),e.number&&(t+=20),e.special&&(t+=20);let o="",a="#f97373";t<40?(o="Weak",a="#f97373"):t<60?(o="Fair",a="#fb923c"):t<80?(o="Good",a="#fbbf24"):t<100?(o="Strong",a="#4ade80"):(o="Very Strong",a="#22c55e");const u=e.length&&e.uppercase&&e.number&&e.special;if(!u){const l=[];e.length||l.push("8 characters"),e.uppercase||l.push("uppercase letter"),e.number||l.push("number"),e.special||l.push("special character"),o+=` (needs: ${l.join(", ")})`}return{strength:t,text:o,color:a,valid:u}}h?.addEventListener("input",n=>{const t=n.target.value,e=I(t);g&&(g.style.width=`${e.strength}%`,g.style.background=e.color),p&&(p.textContent=e.text,p.style.color=e.color),y?.value&&w()});function w(){const n=h?.value,t=y?.value;return t?n===t?(c&&(c.textContent="✓ Passwords match",c.style.color="#4ade80"),!0):(c&&(c.textContent="✗ Passwords do not match",c.style.color="#f97373"),!1):(c&&(c.textContent=""),!1)}y?.addEventListener("input",w);E?.addEventListener("submit",async n=>{if(n.preventDefault(),!s)return;const t=h?.value;if(!I(t).valid){s.textContent="Password does not meet requirements.",s.style.color="#f97373";return}if(!w()){s.textContent="Passwords do not match.",s.style.color="#f97373";return}s.textContent="Creating your account...",s.style.color="#cbd5f5";const o=new FormData(E),a=o.get("fullName"),u=o.get("email"),l=o.get("workspace"),S=o.get("cf-turnstile-response");try{const i=await fetch(`${C}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:u,password:t,workspaceName:l,turnstileToken:S})}),d=await i.text();let r={};try{r=d?JSON.parse(d):{}}catch{r={}}console.log("Register response:",i.status,r||d);const x=(d||"").toLowerCase();if(i.status===409||r?.error==="EMAIL_IN_USE"||r?.code==="EMAIL_IN_USE"||x.includes("e11000")||x.includes("duplicate key")){s.textContent="This address is already in use. Try signing in instead.",s.style.color="#f97373";return}if(!i.ok){const f=r?.message||"Registration failed.";s.textContent=f,s.style.color="#f97373";return}try{r&&r.accessToken&&localStorage.setItem("ks_token",r.accessToken);let f=a;const m=r?.user||r?.profile||null;if(m){const k=m.fullName||m.name||m.fullname;k&&(f=k)}f&&localStorage.setItem("ks_full_name",String(f))}catch(f){console.warn("Could not persist user info to localStorage",f)}u&&sessionStorage.setItem("verifyEmail",u),window.location.href=`${b}verify-email`}catch(i){console.error(i),s.textContent=i?.message||"Something went wrong. Please try again.",s.style.color="#f97373"}});
